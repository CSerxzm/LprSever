drop database if exists carmanage;
create database carmanage;
use carmanage;

#创建停车场parklot_inf
create table parklot_inf (
  id int(11),
  name varchar(50) not null comment '停车场名字',
  address varchar(150) default null comment '停车场地址',
  telephone varchar(11) not null comment '电话号码',
  activitynum int(11) default 50 comment '活动车位数',
  fixationnum int(11) default 50 comment '固定车位数',
  activitynum_leave int(11) default 50 comment '剩余活动车位数',
  fixationnum_leave int(11) default 50 comment '剩余固定车位数', 
  activitycost_per int(11) default 5 comment '活动车位元每时',  
  primary key (id)
) engine=innodb auto_increment=10 default charset=utf8;

insert into parklot_inf(id,name,address,telephone,activitynum,fixationnum,activitynum_leave,fixationnum_leave,activitycost_per) values(0,'神风停车场','安徽省合肥市包河区合肥工业大学','15284875380',20,50,20,30,3);


#创建停车位表parkspace_inf
create table parkspace_inf(
  id int(11) not null comment '停车位标识',
  name varchar(50) default null comment '停车位别名',
  idle enum('是','否') default '是' comment '车位闲置',
  hire_start_date datetime default current_timestamp comment '租赁开始时间',
  hire_stop_date datetime default current_timestamp comment '租赁结束时间',
  rentornot enum("是","否") default '否' comment '车辆是否外租', 
  primary key (id)
) engine=innodb auto_increment=10 default charset=utf8;

insert into parkspace_inf(id,name,idle) values(1,'车位01号','是'),(2,'车位02号','是'),(3,'车位03号','是')
,(4,'车位04号','是'),(5,'车位05号','是'),(6,'车位06号','是'),(7,'车位07号','是')
,(8,'车位08号','是'),(9,'车位09号','是'),(10,'车位10号','是'),(11,'车位11号','是')
,(12,'车位12号','是'),(13,'车位13号','是'),(14,'车位14号','是');

create table rent_inf(
  parkspace_id int(11) not null comment '停车位标识',
  rent_start_date datetime comment '外租开始时间',
  rent_stop_date datetime comment '外租结束时间',  
  primary key (parkspace_id),
  constraint fk_rent_parkspace foreign key (parkspace_id) references parkspace_inf(id)
) engine=innodb auto_increment=10 default charset=utf8;


#创建用户表user_inf
create table user_inf (
  loginname varchar(18) not null comment '登录名',
  password varchar(18) not null comment '密码',
  parkspace_id  int(11) default null comment '绑定停车位标识',
  licenseplate  varchar(18) default null comment '绑定车牌号',
  telephone varchar(11) not null comment '电话号码',
  createdate datetime not null default current_timestamp comment '注册时间',
  authority enum('系统管理员','停车场管理员','用户'),
  primary key (loginname),
  constraint fk_parkspace_user foreign key (parkspace_id) references parkspace_inf(id)
) engine=innodb auto_increment=2 default charset=utf8;

insert into user_inf(loginname,password,telephone,authority,parkspace_id,licenseplate) values('user1','password','15284875382','用户',1,'川A00909'),('user2','password','15284875383','用户',2,'川HA3456');

insert into user_inf(loginname,password,telephone,authority) values('root','password','15284875380','系统管理员'),('admin','password','15284875381','停车场管理员');


#创建费用表chargeuser_inf
create table chargeuser_inf(
  id int(11) not null auto_increment comment '标识',
  date_pay datetime not null default current_timestamp comment '交易时间',
  name varchar(18) comment '缴费用户名',
  cost int(11) default 0 comment '费用(正为收入，负为支出,负表示用户所得)',
  primary key (id),
  constraint fk_parkspace_chargeuser foreign key (name) references user_inf(loginname)
) engine=innodb auto_increment=2 default charset=utf8;

#创建通行日志表trarecord_inf
create table trarecord_inf(
  id int(11) not null auto_increment,
  space_id int(11) comment '停车位标识',
  licenseplate varchar(18) not null,
  date_in datetime not null default current_timestamp,
  date_out datetime not null default current_timestamp,
  cost int(11) default 0 comment '默认费用',
  primary key (id),
  constraint fk_parkspace_trarecord foreign key (space_id) references parkspace_inf(id)
) engine=innodb auto_increment=2 default charset=utf8;

insert into trarecord_inf(id,space_id,licenseplate,date_in,date_out) values(0,1,'川HA3456','2019-12-15 16:5:55','2019-12-15 16:5:55');

#公告表
create table notice_inf (
  id int(11) not null auto_increment,
  title varchar(50) not null,
  content text not null,
  create_date datetime not null default current_timestamp,
  name_publish  varchar(18) not null,
  primary key (id),
  key fk_notice_user (name_publish),
  constraint fk_notice_user foreign key (name_publish) references user_inf(loginname)
) engine=innodb auto_increment=19 default charset=utf8;

insert into notice_inf(title,content,name_publish) values('四川省教育厅发现新大陆','据新华网3月9日报道，四川新成立防疫大学，预计2080年建成，招生10000000万人','admin');